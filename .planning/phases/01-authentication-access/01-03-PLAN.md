---
phase: 01-authentication-access
plan: 03
type: execute
wave: 3
depends_on: ["02"]
files_modified:
  - apps/web/package.json
  - apps/web/app/layout.tsx
  - apps/web/app/page.tsx
  - apps/web/.env.example
autonomous: true
user_setup:
  - service: workos
    why: "AuthKit hosted email/password auth"
    env_vars:
      - name: WORKOS_API_KEY
        source: "WorkOS Dashboard -> API Keys"
      - name: WORKOS_CLIENT_ID
        source: "WorkOS Dashboard -> Project Settings"
      - name: WORKOS_COOKIE_PASSWORD
        source: "Generate 32+ char secret (local secret manager)"
      - name: WORKOS_REDIRECT_URI
        source: "WorkOS Dashboard -> Redirect URIs"
      - name: NEXT_PUBLIC_WORKOS_REDIRECT_URI
        source: "Same as WORKOS_REDIRECT_URI (client-readable)"
    dashboard_config:
      - task: "Enable AuthKit Email+Password and keep default verification/reset emails enabled"
        location: "WorkOS Dashboard -> Authentication -> AuthKit"

must_haves:
  truths:
    - "Signed-out visitors can click Log in and Sign up links that open WorkOS AuthKit"
  artifacts:
    - path: "apps/web/app/layout.tsx"
      provides: "AuthKitProvider wrapper"
    - path: "apps/web/app/page.tsx"
      provides: "Auth-aware home view"
    - path: "apps/web/.env.example"
      provides: "WorkOS env variable placeholders"
    - path: "apps/web/package.json"
      provides: "@workos-inc/authkit-nextjs dependency"
  key_links:
    - from: "apps/web/app/layout.tsx"
      to: "@workos-inc/authkit-nextjs"
      via: "AuthKitProvider import"
      pattern: "AuthKitProvider"
    - from: "apps/web/app/page.tsx"
      to: "getSignInUrl/getSignUpUrl"
      via: "WorkOS hosted auth links"
      pattern: "getSign(In|Up)Url"
    - from: "apps/web/app/page.tsx"
      to: "signOut"
      via: "server action"
      pattern: "signOut"
---

<objective>
Integrate WorkOS AuthKit provider and signed-in/signed-out UI entry points.

Purpose: Enable hosted email/password auth links and session-aware UI for Phase 1.
Output: AuthKit dependency, provider wrapper, and auth-aware home page.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-authentication-access/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add AuthKit dependency and env example</name>
  <files>apps/web/package.json, apps/web/.env.example</files>
  <action>
    - Install @workos-inc/authkit-nextjs in apps/web using pnpm.
    - Create apps/web/.env.example with WORKOS_API_KEY, WORKOS_CLIENT_ID, WORKOS_COOKIE_PASSWORD (32+ chars), WORKOS_REDIRECT_URI, and NEXT_PUBLIC_WORKOS_REDIRECT_URI.
    - Add short inline comments in .env.example clarifying that redirect URI must match the WorkOS dashboard config.
  </action>
  <verify>pnpm -C apps/web lint</verify>
  <done>Dependency is installed and .env.example documents all required WorkOS env vars.</done>
</task>

<task type="auto">
  <name>Task 2: Wire AuthKitProvider and auth-aware home page</name>
  <files>apps/web/app/layout.tsx, apps/web/app/page.tsx</files>
  <action>
    - Wrap the root layout with AuthKitProvider from @workos-inc/authkit-nextjs (server component compatible).
    - Update app/page.tsx to call withAuth() on the server. If user is null, render Log in and Sign up links using getSignInUrl/getSignUpUrl. If user exists, render a sign-out form that calls signOut() in a server action.
    - Keep UI minimal and functional; no custom auth UI or password handling (hosted AuthKit only).
  </action>
  <verify>pnpm -C apps/web build</verify>
  <done>Home page renders sign-in/up links when signed out and a sign-out action when signed in.</done>
</task>

</tasks>

<verification>
- pnpm -C apps/web build completes successfully
</verification>

<success_criteria>
- Signed-out view shows WorkOS hosted auth links
- Signed-in view shows a working sign-out action
- Env variable placeholders exist for WorkOS setup
</success_criteria>

<output>
After completion, create `.planning/phases/01-authentication-access/01-03-SUMMARY.md`
</output>
