---
phase: 03-member-enrollment
plan: 04
type: execute
wave: 4
depends_on: ["03-03"]
files_modified: []
autonomous: false
user_setup:
  - service: convex
    why: "Deploy updated schema with search indexes"
    env_vars: []
    dashboard_config: []

must_haves:
  truths:
    - "Member can search for a stake"
    - "Member can search for a ward"
    - "Member can join a ward and stake and see membership confirmed"
  artifacts: []
  key_links: []
---

<objective>
Verify Phase 3 requirements are satisfied through end-to-end testing of member enrollment.

Purpose: Confirm MEMB-01, MEMB-02, MEMB-03 requirements pass
Output: Phase 3 verified and marked complete
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete member enrollment system with search and join capabilities</what-built>
  <how-to-verify>
Start the dev server and test the full flow:

```bash
pnpm dev
```

**Test MEMB-01: Member can search for a stake**
1. Open http://localhost:3000/dashboard
2. Click "Find and Join a Ward"
3. In the search box, type part of an existing stake name
4. Verify: Matching stakes appear in the results
5. Clear the search box
6. Verify: All stakes are shown (browse mode)

**Test MEMB-02: Member can search for a ward**
1. Click on a stake from the search results
2. Verify: Wards under that stake are displayed
3. Verify: Ward names and details are visible

**Test MEMB-03: Member can join a ward and stake and see membership confirmed**
1. Click "Join" on one of the wards
2. Verify: Success message appears confirming you joined
3. Go to /dashboard/membership (or click the membership link)
4. Verify: The ward you joined appears in your memberships
5. Verify: The parent stake also appears in your memberships
6. Verify: Both show role as "member"

**Test duplicate prevention:**
1. Go back to /dashboard/join
2. Try to join the same ward again
3. Verify: Error message says you're already a member

**Check Convex Dashboard:**
- View the memberships table
- Verify: Two new records created (one ward, one stake) with role "member"
  </how-to-verify>
  <resume-signal>Type "verified" if all tests pass, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
Phase 3 requirements verification:

| Requirement | Test | Expected Result |
|-------------|------|-----------------|
| MEMB-01 | Search for stake by name | Matching stakes appear in results |
| MEMB-02 | Select stake, view wards | Wards displayed under selected stake |
| MEMB-03 | Join ward, check membership | Ward + stake memberships created, visible in membership page |
</verification>

<success_criteria>
- Stake search works (MEMB-01)
- Ward search/browse within stake works (MEMB-02)
- Join creates ward + stake memberships, shown in membership page (MEMB-03)
- Duplicate join prevented with clear error
</success_criteria>
