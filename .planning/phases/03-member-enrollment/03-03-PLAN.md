---
phase: 03-member-enrollment
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - apps/web/app/dashboard/join/page.tsx
  - apps/web/app/dashboard/membership/page.tsx
  - apps/web/app/dashboard/page.tsx
autonomous: true
---

<objective>
Build the member enrollment UI: search for stakes/wards, join a ward, and view membership confirmation.

Purpose: UI for the complete member enrollment journey (search -> join -> confirm)
Output: /dashboard/join page with search + join flow, /dashboard/membership page showing current memberships, updated dashboard with links
</objective>

<context>
@.planning/phases/03-member-enrollment/03-RESEARCH.md
@apps/web/app/dashboard/page.tsx
@apps/web/app/dashboard/stakes/page.tsx
@apps/web/app/dashboard/stakes/new/page.tsx
@apps/web/app/dashboard/stakes/[stakeId]/page.tsx
@apps/web/components/ConvexClientProvider.tsx
</context>

<tasks>

<task type="code">
  <name>Task 1: Create join page at /dashboard/join</name>
  <file>apps/web/app/dashboard/join/page.tsx</file>
  <action>
Create a "use client" page with the enrollment flow:

1. **Step 1: Search stakes** — Text input for stake search. Uses `useQuery(api.stakes.search, { query })`. Shows list of matching stakes as clickable items.

2. **Step 2: Select ward** — When a stake is selected, show its wards using `useQuery(api.wards.listByStake, { stakeId })` (or `wards.searchByStake`). Each ward shows a "Join" button.

3. **Step 3: Join confirmation** — On clicking "Join", call `useMutation(api.memberships.joinWard)`. Show success message with the ward and stake names. Include a link to "/dashboard/membership" to view memberships.

Handle loading states, errors (already a member), and empty states. Use Tailwind CSS for styling consistent with existing pages.
  </action>
</task>

<task type="code">
  <name>Task 2: Create membership page at /dashboard/membership</name>
  <file>apps/web/app/dashboard/membership/page.tsx</file>
  <action>
Create a "use client" page that shows the current user's memberships:

- Uses `useQuery(api.memberships.myMemberships)` to fetch enriched membership data
- Groups by type: shows stake memberships and ward memberships separately
- For ward memberships, shows parent stake name
- Shows role (leader/member) for each
- Ward memberships have a "Leave" button (calls `memberships.leaveWard`); disabled for leaders
- Link back to /dashboard/join to find more wards
  </action>
</task>

<task type="code">
  <name>Task 3: Update dashboard page with enrollment links</name>
  <file>apps/web/app/dashboard/page.tsx</file>
  <action>
Add links to the dashboard:
- "Find and Join a Ward" link to /dashboard/join
- "My Memberships" link to /dashboard/membership
Keep existing "Create Stake" and "View all stakes" links.
  </action>
</task>

<task type="verify">
  <name>Task 4: Verify build compiles</name>
  <action>Run the build to check for compilation errors: `pnpm -C apps/web build` or `npx next build` in apps/web.</action>
</task>

</tasks>

<verification>
- /dashboard/join page loads and shows stake search input
- Typing in search filters stakes reactively
- Selecting a stake shows its wards
- Clicking "Join" on a ward creates memberships
- /dashboard/membership page shows current memberships
- Dashboard page has links to join and membership pages
- No build errors
</verification>

<success_criteria>
- Join page with complete search -> select -> join flow
- Membership page showing current memberships with leave capability
- Dashboard updated with enrollment links
- Application builds without errors
</success_criteria>
