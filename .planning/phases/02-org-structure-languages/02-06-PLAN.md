---
phase: 02-org-structure-languages
plan: 06
type: execute
wave: 4
depends_on: ["02-05"]
files_modified: []
autonomous: false
user_setup:
  - service: convex
    why: "Deploy Convex backend"
    env_vars:
      - name: NEXT_PUBLIC_CONVEX_URL
        source: "Output from npx convex dev"
    dashboard_config:
      - task: "Set WORKOS_CLIENT_ID in Convex dashboard"
        location: "Convex Dashboard -> Settings -> Environment Variables"

must_haves:
  truths:
    - "Stake leader can create a stake"
    - "Ward leader can create a ward under a stake"
    - "Stake or ward can set supported languages to English and/or Spanish"
  artifacts: []
  key_links: []
---

<objective>
Verify Phase 2 requirements are satisfied through end-to-end testing of stake/ward management.

Purpose: Confirm ORG-01, ORG-02, ORG-03 requirements pass
Output: Phase 2 verified and marked complete
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Set up Convex environment</name>
  <action>
User must complete Convex setup:

1. **Create Convex account** (if not already): https://convex.dev

2. **Deploy backend**:
```bash
cd apps/web
npx convex dev
```
This will:
- Prompt you to log in to Convex (browser opens)
- Create a new Convex project
- Deploy the schema and functions
- Output the NEXT_PUBLIC_CONVEX_URL

3. **Add environment variable**:
Copy the deployment URL to `apps/web/.env.local`:
```
NEXT_PUBLIC_CONVEX_URL=https://your-project.convex.cloud
```

4. **Set WorkOS client ID in Convex dashboard**:
- Go to your Convex project dashboard
- Navigate to Settings -> Environment Variables
- Add: `WORKOS_CLIENT_ID` = (your WorkOS client ID from .env.local)
  </action>
  <resume-signal>Type "convex ready" when Convex is deployed and env vars are set</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete stake/ward management system with Convex backend</what-built>
  <how-to-verify>
Start the dev server and test the full flow:

```bash
pnpm dev
```

**Test ORG-01: Stake leader can create a stake**
1. Open http://localhost:3000
2. Sign in (you should be redirected to dashboard)
3. Click "Create Stake" or go to /dashboard/stakes/new
4. Enter stake name: "Test Stake"
5. Check "English" and "Spanish" languages
6. Click "Create Stake"
7. Verify: Stake appears in your stakes list

**Test ORG-02: Ward leader can create a ward under a stake**
1. Click on the stake you just created
2. Click "Add Ward"
3. Enter ward name: "Test Ward 1"
4. Click "Create Ward"
5. Verify: Ward appears under the stake

**Test ORG-03: Stake or ward can set supported languages**
1. On the stake detail page, click "Edit" next to languages
2. Uncheck "Spanish" (leave only English)
3. Click "Save"
4. Verify: Stake now shows only "en"
5. Verify: Ward shows "en (inherited)"

**Check Convex Dashboard**:
- Go to your Convex project dashboard
- View the Data tab
- Verify: stakes, wards, memberships, users tables have data
  </how-to-verify>
  <resume-signal>Type "verified" if all tests pass, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
Phase 2 requirements verification:

| Requirement | Test | Expected Result |
|-------------|------|-----------------|
| ORG-01 | Create stake as authenticated user | Stake created, user becomes leader |
| ORG-02 | Create ward under stake | Ward created, linked to stake |
| ORG-03 | Set stake languages to en/es | Languages updated, UI reflects change |
| ORG-03 | Ward inherits stake languages | Ward shows (inherited) when not set |
</verification>

<success_criteria>
- Convex backend deployed and connected
- Stake creation works (ORG-01)
- Ward creation under stake works (ORG-02)
- Language setting works for stake and ward (ORG-03)
- Data persists in Convex database
</success_criteria>

<output>
After completion, create `.planning/phases/02-org-structure-languages/02-06-SUMMARY.md`
</output>
